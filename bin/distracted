#!/bin/bash

# Script to output pomodoro status for starship prompt
# Returns colored output based on current state

# Function to get environment variable or default
get_env_var() {
    local var_name="$1"
    local default_value="$2"
    echo "${!var_name:-$default_value}"
}

current_state=$(get_env_var "POMODORO_STATE" "idle")

if [ "$current_state" = "idle" ]; then
    exit 1  # Don't show anything when idle
fi

# Calculate remaining time
start_time=$(get_env_var "POMODORO_START_TIME" "0")
current_time=$(get_env_var "POMODORO_TIME" "0")

if [ "$start_time" != "0" ]; then
    elapsed=$(( ($(date +%s) - start_time) / 60 ))
    remaining=$((current_time - elapsed))
    if [ $remaining -lt 0 ]; then
        remaining=0
    fi
else
    remaining=$current_time
fi

# Output with appropriate symbol and time
if [ "$current_state" = "work" ]; then
    echo "üçÖ ${remaining}m"
elif [ "$current_state" = "break" ]; then
    echo "‚òï ${remaining}m"
fi
