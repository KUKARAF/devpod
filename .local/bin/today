#!/home/rafa/.config/dotfiles/.local/bin/.venv/bin/python3

import os
import sys
from datetime import datetime

try:
    from timefhuman import timefhuman
except ImportError:
    sys.exit("Error: timefhuman is required. Install with 'pip install timefhuman'.")

def datetime_to_filepath(dt, create=False):
    """
    Convert datetime object to vimwiki diary file path.
    
    Args:
        dt: datetime object
        create: if True and file doesn't exist, create it
    
    Returns:
        absolute file path string
    """
    base = os.path.expanduser('~/vimwiki/diary')
    path = f"{base}/{dt.strftime('%Y-%m-%d')}.md"
    if create and not os.path.exists(path):
        os.makedirs(base, exist_ok=True)
        with open(path, 'w'):
            pass
    return path

def parse_human_date(text):
    """
    Convert human language date into datetime object.
    
    Args:
        text: natural language like 'today', 'this week', 'tomorrow'
    
    Returns:
        datetime object
    """
    parsed = timefhuman(text)
    # return first item regardless of list length; IndexError on empty list is acceptable
    return next(iter(parsed))

def main():
    args = sys.argv[1:]
    if not args:
        # bare 'today' with auto-create
        print(datetime_to_filepath(datetime.today(), create=True))
    else:
        # combine args into one string, prepend "today" for context, and parse
        text = 'today ' + ' '.join(args)
        dt = parse_human_date(text)
        print(datetime_to_filepath(dt))

if __name__ == '__main__':
    main()
